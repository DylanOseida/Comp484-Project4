<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSUN Map Challenge</title>
    <link rel="stylesheet" href="css/style.css" />    
</head>

<body>
    <!-- Quiz content (Instructions, questions, score, timer) -->
    <div id="container">

        <div id="quiz">
        <div>
            <h2>CSUN Map Quiz</h2>
            <p id="instructions">
            <b>Instructions to play:</b><br />Double click on the map the location
            of...
            </p>
            <hr />
            <div id="questions">
            <div class="quiz-item" id="quiz-item"></div>
            <div class="score-item" id="score-item"></div>
            </div>
        </div>
        <section id="bottom-bar">
            <div class="timer">00:00:00</div>
            <button id="resetGameButton" onclick="resetGame()">Reset Game</button>
        </section>
        </div>

        <!-- Map -->
        <div id="map"></div>
    </div>


    <!-- Necessary Scripts -->
    <script src="config.js"></script>
    <script>
    const script = document.createElement("script");
    script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyAuPTXh2v4Qg9zNHLirx7aSlJdqIUFNKMA&callback=initMap`;
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
    </script>
    <script src="script.js"></script>

    <script>
        let map;

        // Google Map Initialization
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 34.239521097884236, lng: -118.52775305654792 },
                zoom: 16.7,
                disableDefaultUI: true, // Disables all default controls
                gestureHandling: "none", // Disables gestures -- panning, zooming
                styles: [
                    {
                        featureType: "all",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }],
                    },
                ],
            });

            // User input: double clicks on map
            map.addListener("dblclick", (event) => {
                startTimer();
                const userLat = event.latLng.lat();
                const userLng = event.latLng.lng();

                const target = locations[curindex];
                curindex++;

                // Check if the user's click is within a 0.0005-degree range of the target location
                const isCorrect =
                    userLat <= target.lat + 0.0005 &&
                    userLat >= target.lat - 0.0005 &&
                    userLng >= target.lng - 0.0005 &&
                    userLng <= target.lng + 0.0005;

                // Create the rectangle
                const bounds = isCorrect ? {
                    north: userLat + 0.0003,
                    south: userLat - 0.0003,
                    east: userLng + 0.0003,
                    west: userLng - 0.0003,
                } : {
                    north: target.lat + 0.0003,
                    south: target.lat - 0.0003,
                    east: target.lng + 0.0003,
                    west: target.lng - 0.0003,
                };

                const rectangle = new google.maps.Rectangle({
                    strokeColor: isCorrect ? "green" : "red",
                    strokeOpacity: 1,
                    fillColor: isCorrect ? "green" : "red",
                    fillOpacity: 0.4,
                    map,
                    bounds: bounds,
                });
                rectangles.push(rectangle);

                // Rectangle added to array for the program to keep track
                rectangles.push(rectangle);

                // Feedback for the user: displays "Correct!" or "Incorrect" after selection is made
                if (isCorrect) {
                document.getElementById("score-item").innerHTML +=
                    "<span style='color: green;'>Correct!</span><br>";
                score++;
                showNextQuestion();

                } else {
                document.getElementById("score-item").innerHTML +=
                    "<span style='color: red;'>Incorrect!</span><br>";
                showNextQuestion();
                }
            });
            showNextQuestion();
        }
    </script>
  </body>
</html>
